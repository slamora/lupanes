{% extends "lupanes/base.html" %}
{% load django_bootstrap5 %}

{% block main %}
<h1>Bienvenido/a {{ request.user.username }}</h1>

<h2>¿Qué quieres hacer?</h2>

{% if request.user.is_customer %}

<!-- Panel de información financiera (no accionable) -->
<div class="alert {% if projected_balance and projected_balance > 0 %}alert-primary{% else %}alert-danger{% endif %} mb-4" role="alert">
  <div class="row g-2 text-center">
    <!-- Saldo Actual -->
    <div class="col-12 col-md-4">
      <div class="p-2">
        <small class="d-block text-muted mb-1">
          <i class="fa-solid fa-wallet"></i> Saldo Actual
        </small>
        <strong class="fs-4">{{ balance|floatformat:"2" }} €</strong>
      </div>
    </div>

    <!-- Consumo del Mes -->
    <div class="col-12 col-md-4">
      <div class="p-2 {% if projected_balance is not None and projected_balance <= 0 %}border-start border-end{% endif %}">
        <small class="d-block text-muted mb-1">
          <i class="fa-solid fa-shopping-cart"></i> Consumo del Mes
        </small>
        <strong class="fs-4">{% if consumption is not None %}{{ consumption|floatformat:"2" }}{% else %}0.00{% endif %} €</strong>
      </div>
    </div>

    <!-- Previsión de Saldo -->
    <div class="col-12 col-md-4">
      <div class="p-2">
        <small class="d-block text-muted mb-1">
          <i class="fa-solid fa-chart-line"></i> Previsión de Saldo
        </small>
        <strong class="fs-4">
          {% if projected_balance is not None %}{{ projected_balance|floatformat:"2" }}{% else %}N/A{% endif %} €
        </strong>
      </div>
    </div>
  </div>
</div>

<!-- Botones de acción -->
<div class="d-grid gap-2 col-lg-4">
  <a class="btn btn-lg btn-outline-success" href="{% url 'lupanes:deliverynote-new' %}">
    <i class="fa-solid fa-plus"></i> Apuntar mi compra (albarán)</a>
  <a class="btn btn-lg btn-outline-secondary" href="{% url 'lupanes:deliverynote-current-month-customer' %}">
    <i class="fa-solid fa-list"></i> Consultar mis albaranes</a>
  <a class="btn btn-lg btn-outline-warning" href="{% url 'lupanes:product-list' %}">
    <i class="fa-solid fa-euro-sign"></i> Consultar el listado de precios</a>
</div>

{% elif request.user.is_manager %}
<h3>Tareas de gestión</h3>
<div class="d-grid gap-2 col-lg-4">
  <a class="btn btn-lg btn-outline-success" href="{% url 'lupanes:deliverynote-new-bulk' %}">
    <i class="fa-solid fa-plus"></i> Crear un albarán</a>
  <a class="btn btn-lg btn-outline-secondary" href="{% url 'lupanes:deliverynote-current-month' %}">
    <i class="fa-solid fa-list"></i> Consultar el listado de albaranes</a>
  <a class="btn btn-lg btn-outline-warning" href="{% url 'lupanes:product-list' %}">
    <i class="fa-solid fa-euro-sign"></i> Gestionar los productos y precios</a>
  <a class="btn btn-lg btn-outline-primary" href="{% url 'lupanes:customer-list' %}">
    <i class="fa-solid fa-users"></i> Gestionar las neveras</a>
</div>
{% endif %}
{% endblock main %}
